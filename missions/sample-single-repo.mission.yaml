# Sample Mission: Single Repo ADK Compliance Audit
#
# This mission audits the current repository for ADK compliance,
# creates issues for any violations found, and generates a report.
#
# Usage:
#   python -m agents.mission_spec.runner validate missions/sample-single-repo.mission.yaml
#   python -m agents.mission_spec.runner dry-run missions/sample-single-repo.mission.yaml

mission_id: "audit-adk-compliance"
title: "Audit iam-* agents for ADK compliance"
intent: "Ensure all agents follow Hard Mode rules R1-R8 and ADK best practices"
version: "1"

scope:
  repos:
    - path: "."  # Current repository

workflow:
  - step: "analyze"
    agent: "iam-compliance"
    inputs:
      target: "agents/"  # Directory to analyze (skill expects 'target' not 'targets')
      focus_rules:
        - "R1"  # ADK-Only
        - "R2"  # Vertex AI Agent Engine
        - "R5"  # Dual memory wiring
      severity_threshold: "LOW"
    outputs:
      - name: "compliance_report"
        description: "ADK compliance analysis results"

  - step: "triage"
    agent: "iam-triage"
    skill_id: "iam_issue.convert_finding_to_issue"  # Explicit skill
    depends_on:
      - "analyze"
    inputs:
      # Skill expects 'finding' object with message and severity
      finding:
        message: "ADK compliance audit completed - see analyze step for details"
        severity: "MEDIUM"
        rule: "R1-R5"
        recommendation: "Review compliance report and address any violations"
      repo_context:
        repo_name: "bobs-brain"
        branch: "main"
    outputs:
      - name: "issue_spec"
        description: "Issue spec for tracking compliance work"

  - step: "document"
    agent: "iam-docs"
    skill_id: "iam_doc.generate_aar"  # Explicit skill
    depends_on:
      - "analyze"
      - "triage"
    inputs:
      # Skill expects 'phase_info' object with phase_name, objectives, outcomes
      phase_info:
        phase_name: "ADK Compliance Audit"
        objectives:
          - "Audit agents for Hard Mode rules R1-R8"
          - "Identify compliance violations"
          - "Create tracking issues for violations"
        outcomes:
          status: "completed"
          agents_audited: 10
          compliance_check_passed: true
        lessons_learned:
          - "Mission Spec successfully orchestrated multi-agent workflow"
          - "A2A delegation working with Vertex AI"
    outputs:
      - name: "aar_document"
        description: "After-Action Report for the audit"

mandate:
  budget_limit: 2.0
  budget_unit: "USD"
  max_iterations: 50
  authorized_specialists:
    - "iam-compliance"
    - "iam-triage"
    - "iam-docs"
  risk_tier: "R1"  # Local changes only
  data_classification: "internal"

evidence:
  bundle_required: true
  include:
    - "compliance_report"
    - "issue_specs"
    - "audit_summary"
